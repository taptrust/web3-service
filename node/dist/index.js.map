{"version":3,"sources":["../src/index.js"],"names":["require","config","express","bodyParser","account","relay","app","use","json","type","all","req","res","next","publicKey","query","username","createAccount","then","user","contractAddress","contract_address","catch","post","body","signature","action","params","relaySendTransactionMessage","result","getUsers","users","status","set","send","join","end","getUserNonce","address","nonce","console","log","get","port","process","env","PORT","listen"],"mappings":";;AAAA;AACAA,QAAQ,QAAR,EAAkBC,MAAlB;AACA,IAAMC,UAAUF,QAAQ,SAAR,CAAhB;AACA,IAAMG,aAAaH,QAAQ,aAAR,CAAnB;AACA,IAAMI,UAAUJ,QAAQ,WAAR,CAAhB;;AAEA,IAAMK,QAAQL,QAAQ,SAAR,CAAd;AACA,IAAMM,MAAMJ,SAAZ;;AAGAI,IAAIC,GAAJ,CAAQJ,WAAWK,IAAX,CAAgB,EAAEC,MAAM,kBAAR,EAAhB,CAAR;;AAGAH,IAAII,GAAJ,CAAQ,gBAAR,EAA0B,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5C,MAAIC,YAAYH,IAAII,KAAJ,CAAUD,SAA1B;AACA,MAAIE,WAAWL,IAAII,KAAJ,CAAUC,QAAzB;AACAZ,UAAQa,aAAR,CAAsBD,QAAtB,EAAgCF,SAAhC,EACGI,IADH,CACQ,UAACC,IAAD,EAAU;AACdP,QAAIJ,IAAJ,CAAS,EAACY,iBAAiBD,KAAKE,gBAAvB,EAAT;AACD,GAHH,EAIGC,KAJH,CAIST,IAJT;AAKD,CARD;;AAUAP,IAAIiB,IAAJ,CAAS,eAAT,EAA0B,UAACZ,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC5C,MAAIG,WAAWL,IAAIa,IAAJ,CAASR,QAAxB;AACA,MAAIS,YAAYd,IAAIa,IAAJ,CAASC,SAAzB;AACA,MAAIL,kBAAkBT,IAAIa,IAAJ,CAASJ,eAA/B;AACA,MAAIM,SAASf,IAAIa,IAAJ,CAASE,MAAtB;AACA,MAAIC,SAAShB,IAAIa,IAAJ,CAASG,MAAtB;;AAEA,UAAQD,MAAR;AACE,SAAK,iBAAL;AACErB,YAAMuB,2BAAN,CAAkCZ,QAAlC,EAA4CS,SAA5C,EAAuDL,eAAvD,EAAwEM,MAAxE,EAAgFC,MAAhF,EACGT,IADH,CACQ,UAACW,MAAD,EAAY;AAChBjB,YAAIJ,IAAJ,CAAS,EAACqB,QAAQA,MAAT,EAAT;AACD,OAHH;AAIA;AACF;AACEjB,UAAIJ,IAAJ,CAAS,EAAC,SAAS,4BAA4BkB,MAAtC,EAAT;AACA;AATJ;AAYD,CAnBD;;AAqBApB,IAAII,GAAJ,CAAQ,WAAR,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvCT,UAAQ0B,QAAR,GACGZ,IADH,CACQ,UAACa,KAAD,EAAW;AACfnB,QACGoB,MADH,CACU,GADV,EAEGC,GAFH,CAEO,cAFP,EAEuB,YAFvB,EAGGC,IAHH,sBAG2BH,MAAMI,IAAN,CAAW,IAAX,CAH3B,EAIGC,GAJH;AAKD,GAPH,EAQGd,KARH,CAQST,IART;AASD,CAVD;;AAYAP,IAAII,GAAJ,CAAQ,YAAR,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACzCT,UAAQiC,YAAR,CAAqB1B,IAAII,KAAJ,CAAUuB,OAA/B,EACIpB,IADJ,CACS,UAACqB,KAAD,EAAW;AACnBC,YAAQC,GAAR,CAAY,qBAAqBF,KAAjC;AACA3B,QAAIJ,IAAJ,CAAS,EAAC,SAAS+B,KAAV,EAAT;AACG,GAJJ,EAKIjB,KALJ,CAKUT,IALV;AAMA,CAPD;;AAUAP,IAAIoC,GAAJ,CAAQ,GAAR,EAAa,UAAC/B,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC7BD,MAAIJ,IAAJ,CAAS,EAAE,WAAW,aAAb,EAAT;AACH,CAFD;;AAKA,IAAMmC,OAAOC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAAjC;AACAxC,IAAIyC,MAAJ,CAAWJ,IAAX,EAAiB,YAAM;AACnBH,UAAQC,GAAR,oCAA6CE,IAA7C;AACH,CAFD","file":"index.js","sourcesContent":["// om namah shivay\r\nrequire('dotenv').config();\r\nconst express = require('express');\r\nconst bodyParser = require('body-parser');\r\nconst account = require('./account');\r\n\r\nconst relay = require('./relay');\r\nconst app = express();\r\n\r\n\r\napp.use(bodyParser.json({ type: 'application/json' }))\r\n\r\n\r\napp.all('/createAccount', (req, res, next) => {\r\n  let publicKey = req.query.publicKey;\r\n  let username = req.query.username;\r\n  account.createAccount(username, publicKey)\r\n    .then((user) => {\r\n      res.json({contractAddress: user.contract_address});\r\n    })\r\n    .catch(next);\r\n});\r\n\r\napp.post('/relayMessage', (req, res, next) => {\r\n  let username = req.body.username;\r\n  let signature = req.body.signature;\r\n  let contractAddress = req.body.contractAddress;\r\n  let action = req.body.action;\r\n  let params = req.body.params;\r\n\r\n  switch (action) {\r\n    case 'sendTransaction':\r\n      relay.relaySendTransactionMessage(username, signature, contractAddress, action, params)\r\n        .then((result) => {\r\n          res.json({result: result});\r\n        });\r\n      break; \r\n    default: \r\n      res.json({'error': 'Action not recognized: ' + action});\r\n      break\r\n  }\r\n  \r\n});\r\n\r\napp.all('/getUsers', (req, res, next) => {\r\n  account.getUsers()\r\n    .then((users) => {\r\n      res\r\n        .status(200)\r\n        .set('Content-Type', 'text/plain')\r\n        .send(`Last 10 users:\\n${users.join('\\n')}`)\r\n        .end();\r\n    })\r\n    .catch(next);\r\n});\r\n\r\napp.all('/getTxInfo', (req, res, next) => {\r\n\taccount.getUserNonce(req.query.address)\r\n    .then((nonce) => {\r\n\t\tconsole.log('got user nonce: ' + nonce);\r\n\t\tres.json({'nonce': nonce});\r\n    })\r\n    .catch(next);\r\n});\r\n\r\n\r\napp.get('/', (req, res, next) => {\r\n    res.json({ 'message': 'hello world' });\r\n});\r\n\r\n\r\nconst port = process.env.PORT || 8080;\r\napp.listen(port, () => {\r\n    console.log(`Node server listening on port ${port}`);\r\n});\r\n"]}